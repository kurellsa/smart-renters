<!DOCTYPE html>
<html>
<head>
    <title>Property Management Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #fdfdfd; }
        .report-card { border: 1px solid #eee; padding: 20px; border-radius: 12px; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .status-ok { color: #28a745; font-weight: bold; }
        .status-err { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body class="container py-5">
    {% if request.query_params.get('msg') == 'success' %}
    <div class="alert alert-success alert-dismissible fade show shadow-sm mb-4" role="alert">
        <div class="d-flex align-items-center">
            <span class="fs-4 me-3">âœ…</span>
            <div>
                <h5 class="alert-heading mb-1">Reconciliation Complete!</h5>
                <p class="mb-0">The database has been updated for <strong>{{ selected_month }}</strong> and the summary email was dispatched.</p>
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}
    <h1 class="mb-4">ðŸ“Š Executive Summary: {{ selected_month }}</h1>

    <div class="row mb-5">
        <div class="col-md-6">
            <div class="report-card">
                <h3>GOGO PROPERTY Portfolio</h3>
                <p class="fs-5">Calculated Net: <strong>${{ "%.2f"|format(gogo_total) }}</strong></p>
                <p>Bank Status: <span class="{{ 'status-ok' if 'âœ…' in gogo_match else 'status-err' }}">{{ gogo_match }}</span></p>
            </div>
        </div>
        <div class="col-md-6">
            <div class="report-card">
                <h3>SURE REALTY</h3>
                <p class="fs-5">Calculated Net: <strong>${{ "%.2f"|format(sure_total) }}</strong></p>
                <p>Bank Status: <span class="{{ 'status-ok' if 'âœ…' in sure_match else 'status-err' }}">{{ sure_match }}</span></p>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-body bg-light">
            <form method="get" class="row g-3">
                <div class="col-md-4">
                    <input type="month" name="month_year" class="form-control" value="{{ selected_month }}">
                </div>
                <div class="col-md-4">
                    <select name="property_management" class="form-select">
                        <option value="">All Prop Mgmt</option>
                        <option value="GOGO PROPERTY" {% if selected_property_management == 'GOGO PROPERTY' %}selected{% endif %}>GOGO PROPERTY</option>
                        <option value="SURE REALTY" {% if selected_property_management == 'SURE REALTY' %}selected{% endif %}>SURE REALTY</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">Refresh Data</button>
                </div>
            </form>
        </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Detailed Transactions (Baselane Ready)</h4>
        <a href="/export/baselane?month_year={{ selected_month }}&property_management={{ selected_property_management or '' }}" class="btn btn-success">ðŸ“¥ Download CSV</a>
    </div>

    <div class="table-responsive bg-white rounded shadow-sm">
        <table class="table table-hover mb-0">
            <thead class="table-dark">
                <tr>
                    <th>Date</th>
                    <th>Property</th>
                    <th>Category</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for s in statements %}
                <tr>
                    <td>{{ s.statement_date.strftime('%b %d, %Y') }}</td>
                    <td>{{ s.address }}</td>
                    <td><span class="badge bg-info">Rents</span></td>
                    <td class="text-success">+${{ "%.2f"|format(s.rent_paid) }}</td>
                </tr>
                {% if s.management_fees != 0 %}
                <tr>
                    <td>{{ s.statement_date.strftime('%b %d, %Y') }}</td>
                    <td>{{ s.address }}</td>
                    <td><span class="badge bg-warning text-dark">Management Fees</span></td>
                    <td class="text-danger">-${{ "%.2f"|format(s.management_fees|abs) }}</td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
    <script>
    // Auto-dismiss the alert after 5 seconds
    setTimeout(function() {
        let alert = document.querySelector('.alert');
        if (alert) {
            let bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        }
    }, 5000);
</script>
</body>
</html>